# Project Context

## Purpose
Seaswim is a web application that provides water condition data for sea swimming locations in the Netherlands. It helps swimmers make informed decisions about when and where to swim by displaying relevant environmental data.

**Key features:**
- Dashboard for selecting swim locations and viewing water conditions
- CLI tool for accessing the same information from the command line
- APIs for wearable devices (smartwatches, fitness trackers)

## Tech Stack
- **Backend:** PHP 8.4 with Symfony 7.4
- **Frontend:** Vue.js 3 (dashboard)
- **API:** API Platform (for wearable device integration)
- **Caching:** Filesystem-based (`var/api-cache/`) - no database
- **Package Manager:** Composer (PHP), npm (frontend)
- **Local Development:** DDEV (nginx-fpm, Node.js 20)
- **Build Tools:** Webpack Encore, Makefile
- **Code Quality:** PHP-CS-Fixer (PSR-12), Psalm (level 3), PHPUnit
- **CI:** GitHub Actions (lint, analyse, test, build)

## Local Development
The project uses DDEV for local development. All common tasks are available via Makefile commands that wrap DDEV:

```bash
make start    # Start DDEV environment
make stop     # Stop DDEV environment
make install  # Install dependencies (composer + npm)
make test     # Run PHPUnit tests
make lint     # Run PHP-CS-Fixer
make analyse  # Run Psalm static analysis
make build    # Build frontend assets
make ci       # Run all checks
```

## Project Conventions

### Code Style
- Follow PSR-12 coding standard for PHP
- Use PHP CS Fixer or PHP_CodeSniffer for enforcement
- Vue.js: Follow Vue.js style guide (Priority A and B rules)
- Use strict typing in PHP (`declare(strict_types=1)`)

### Architecture Patterns
- **Hexagonal Architecture** (Ports & Adapters)
  - Domain layer: Core business logic, entities, value objects (no framework dependencies)
  - Application layer: Use cases, ports (interfaces), DTOs
  - Infrastructure layer: Adapters for external systems (database, APIs, CLI, web)
- Symfony as infrastructure: controllers, repositories, and services are adapters
- API Platform resources as driving adapters for RESTful endpoints
- Vue.js single-file components (.vue) for frontend adapter

### Testing Strategy
- **Unit tests:** PHPUnit for PHP business logic
- **Integration tests:** Symfony WebTestCase for API endpoints
- **Frontend tests:** Vitest for Vue components (not yet configured)
- Aim for test coverage on critical paths (data retrieval, API endpoints)

### Git Workflow
- All changes must be committed when finished
- No AI attribution in commit messages (no "Generated by Claude", "Co-Authored-By: Claude", etc.)
- Main branch: `master`
- Feature development via OpenSpec change proposals

## Domain Context
- **Swim locations:** Named locations along the Dutch coast/lakes with geographic coordinates
- **Water conditions:** Water temperature, wave height, water height, current speed
- **Weather conditions:** Air temperature, wind speed, wind direction, UV index
- **Data sources:** Rijkswaterstaat (water data), KNMI (weather data)
- Target users: Sea swimmers, open water swimming enthusiasts in the Netherlands

## Important Constraints
- Data freshness: API responses cached for 5 minutes (water) and 10 minutes (weather)
- Stale cache fallback when external APIs are unavailable
- No database required - filesystem-based caching only

## External Dependencies
- **Rijkswaterstaat API:** Water conditions (temperature, waves, currents)
- **KNMI API:** Weather conditions (air temperature, wind, UV index)
